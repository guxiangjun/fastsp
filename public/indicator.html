<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indicator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      background: transparent;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
    }
    #app {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: flex-start;    /* æ”¹ä¸ºé¡¶éƒ¨å¯¹é½ */
      justify-content: flex-start; /* æ”¹ä¸ºå·¦å¯¹é½ */
      background: transparent;
    }
    .emoji-container {
      font-size: 16px; /* ğŸ”§ è°ƒæ•´emojiå¤§å°ï¼Œé»˜è®¤28px */
      line-height: 1;
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.5) rotate(-10deg);
      }
      to {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="emoji-container" id="emoji">ğŸµ</div>
  </div>
  
  <script>
    console.log('Emoji indicator script loaded');
    
    // ğŸ”§ é…ç½®åŒºåŸŸ - å¯è°ƒæ•´å‚æ•°
    const CONFIG = {
      updateInterval: 500,         // emojiåˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤800ms
      fontSize: 16,                // emojiå­—ä½“å¤§å°ï¼ˆåƒç´ ï¼‰
    };
    
    // æ ¹æ®çŠ¶æ€é€‰æ‹©ä¸åŒçš„emojiæ± 
    let currentMode = 'recording'; // 'recording' or 'llm'
    
    const emojiPools = {
      recording: [
        // äººç‰©è¡¨æƒ…emoji - å½•éŸ³æ—¶æ˜¾ç¤º
        'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰',
        'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜',
        'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’',
        'ğŸ¥±', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ¤”', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¬',
        'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥º', 'ğŸ˜³', 'ğŸ¥´', 'ğŸ˜µ'
      ],
      llm: [
        // AI/å·¥å…·ç›¸å…³emoji - LLMå¤„ç†æ—¶æ˜¾ç¤º
        'ğŸ¤–', 'âš¡', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ”®', 'ğŸ§ ', 'ğŸ’­', 'ğŸ¯', 'ğŸ¨',
        'ğŸ”§', 'âš™ï¸', 'ğŸ› ï¸', 'âœï¸', 'ğŸ“', 'ğŸ”', 'ğŸ’¡', 'ğŸš€', 'ğŸª', 'ğŸ­'
      ]
    };
    
    // åº”ç”¨é…ç½®
    const emojiElement = document.getElementById('emoji');
    const container = document.querySelector('.emoji-container');
    container.style.fontSize = `${CONFIG.fontSize}px`;
    
    let updateTimer = null;
    
    function getRandomEmoji(pool) {
      return pool[Math.floor(Math.random() * pool.length)];
    }
    
    function updateEmoji() {
      const pool = emojiPools[currentMode];
      const newEmoji = getRandomEmoji(pool);
      
      // é‡æ–°è§¦å‘åŠ¨ç”»
      emojiElement.style.animation = 'none';
      setTimeout(() => {
        emojiElement.textContent = newEmoji;
        emojiElement.style.animation = 'fadeIn 0.3s ease-in-out';
      }, 10);
    }
    
    function startEmojiUpdate() {
      // æ¸…é™¤æ—§çš„å®šæ—¶å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      if (updateTimer) {
        clearInterval(updateTimer);
      }
      
      // ç«‹å³æ›´æ–°ä¸€æ¬¡
      updateEmoji();
      
      // å®šæœŸæ›´æ–°
      updateTimer = setInterval(updateEmoji, CONFIG.updateInterval);
    }
    
    function stopEmojiUpdate() {
      if (updateTimer) {
        clearInterval(updateTimer);
        updateTimer = null;
      }
    }
    
    // ç›‘å¬Tauriäº‹ä»¶æ¥æ”¹å˜æ¨¡å¼ï¼ˆå½•éŸ³ vs LLMå¤„ç†ï¼‰
    if (window.__TAURI__ && window.__TAURI__.event) {
      window.__TAURI__.event.listen('indicator_color', (event) => {
        console.log('Color change event received:', event.payload);
        const color = event.payload;
        
        // æ ¹æ®é¢œè‰²åˆ¤æ–­æ¨¡å¼
        // #4f9d9a = é’è‰² = å½•éŸ³
        // #dc2626 = çº¢è‰² = LLMå¤„ç†
        if (color === '#dc2626') {
          currentMode = 'llm';
          console.log('Switched to LLM mode');
        } else {
          currentMode = 'recording';
          console.log('Switched to recording mode');
        }
        
        // ç«‹å³æ›´æ–°emojiä»¥åæ˜ æ–°æ¨¡å¼
        updateEmoji();
      }).catch(err => {
        console.warn('Failed to set up event listener:', err);
      });
    }
    
    // å¯åŠ¨æ›´æ–°
    startEmojiUpdate();
    
    console.log('Single emoji indicator ready');
  </script>
</body>
</html>
